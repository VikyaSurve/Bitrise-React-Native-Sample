default_platform(:android)

platform :android do
  desc "Bump version code and version name"
  lane :bump_version do
    # Correct path for React Native project
    gradle_file_path = "./android/app/build.gradle"

    # Read the build.gradle file
    gradle_file = File.read(gradle_file_path)

    # Extract the current versionCode and versionName
    version_code = gradle_file.match(/versionCode\s+(\d+)/)[1].to_i
    version_name = gradle_file.match(/versionName\s+"([^\"]+)"/)[1]

    # Increment the version code
    new_version_code = version_code + 1

    # Increment the version name (assuming semantic versioning)
    new_version_name = "#{version_name.split('.').first}.#{new_version_code}"

    # Replace the versionCode and versionName in the build.gradle file
    new_gradle_file = gradle_file.gsub(/versionCode\s+\d+/, "versionCode #{new_version_code}")
    new_gradle_file = new_gradle_file.gsub(/versionName\s+"[^\"]+"/, "versionName \"#{new_version_name}\"")

    # Write the changes back to the build.gradle file
    File.write(gradle_file_path, new_gradle_file)

    # Commit the version bump
    git_commit(
      path: gradle_file_path,
      message: "Version bump to #{new_version_name} (#{new_version_code})"
    )
  end
end
